<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spynorama</title>
    <link rel="stylesheet" href="style.css">
    <!-- Marzipano local -->
    <script src="js/marzipano.min.js"></script>
    <!-- JSZip pour l'export -->
    <script src="js/jszip.min.js"></script>
    <!-- Icônes personnalisées -->
    <link rel="stylesheet" href="js/icons.css">
</head>
<body>
    <div class="app-container">
        <!-- Barre latérale -->
        <div class="sidebar">
        <!-- Overlay pour fermer le menu sur mobile -->
        <div class="sidebar-overlay"></div>
<div class="sidebar-header">
                <h1>Spynorama</h1>
            </div>
            
            <!-- Section Scènes -->
            <div class="sidebar-section">
                <h2 data-i18n="sidebar.scenes">Scènes</h2>
            <div class="scene-actions">
                <button id="add-scene-btn" class="btn primary"><i class="fas fa-plus"></i> <span data-i18n="scenes.add">Ajouter une scène</span></button>
                <button id="add-scene-url-btn" class="btn"><i class="fas fa-link"></i> <span data-i18n="scenes.addUrl">Ajouter via URL</span></button>
                <input type="file" id="scene-file-input" accept="image/*" multiple style="display: none;">
            </div>
                <div id="scenes-list" class="list-container">
                    <!-- Les scènes seront ajoutées ici dynamiquement -->
                </div>
            </div>
            
            <!-- Section Hotspots -->
            <div class="sidebar-section">
                <h2 data-i18n="sidebar.hotspots">Hotspots</h2>
                <div class="hotspot-actions">
                    <button id="add-info-hotspot-btn" class="btn"><i class="fas fa-info-circle"></i> <span data-i18n="hotspots.info">Info</span></button>
                    <button id="add-link-hotspot-btn" class="btn"><i class="fas fa-link"></i> <span data-i18n="hotspots.link">Lien</span></button>
                    <button id="add-scene-hotspot-btn" class="btn"><i class="fas fa-exchange-alt"></i> <span data-i18n="hotspots.scene">Navigation</span></button>
                    <button id="add-photo-hotspot-btn" class="btn"><i class="fas fa-image"></i> <span data-i18n="hotspots.photo">Photo</span></button>
                    <button id="add-video-hotspot-btn" class="btn"><i class="fas fa-video"></i> <span data-i18n="hotspots.video">Vidéo</span></button>
                    <button id="add-audio-hotspot-btn" class="btn"><i class="fas fa-music"></i> <span data-i18n="hotspots.audio">Audio</span></button>
                </div>
                <div id="hotspots-list" class="list-container">
                    <!-- Les hotspots seront ajoutés ici dynamiquement -->
                </div>
            </div>
            
            <!-- Section Paramètres de la scène active -->
            <div class="sidebar-section">
                <h2 data-i18n="sidebar.settings">Paramètres de la scène</h2>
                <div class="scene-settings">
                    <div class="form-group">
                        <label for="scene-title" data-i18n="scenes.title">Titre</label>
                        <input type="text" id="scene-title" data-i18n-placeholder="scenes.namePlaceholder" placeholder="Titre de la scène">
                    </div>
                    <div class="form-group">
                        <label data-i18n="scenes.initialView">Vue initiale</label>
                        <button id="set-initial-view-btn" class="btn"><i class="fas fa-eye"></i> <span data-i18n="scenes.setCurrentView">Définir vue actuelle</span></button>
                    </div>
                </div>
            </div>
            
            <!-- Section Projet -->
            <div class="sidebar-section">
                <h2 data-i18n="sidebar.project">Projet</h2>
                <div class="project-actions">
                    <button id="new-project-btn" class="btn"><i class="fas fa-file"></i> <span data-i18n="project.new">Nouveau</span></button>
                    <button id="open-project-btn" class="btn"><i class="fas fa-folder-open"></i> <span data-i18n="project.open">Ouvrir</span></button>
                    <button id="save-project-btn" class="btn primary"><i class="fas fa-save"></i> <span data-i18n="project.save">Enregistrer</span></button>
                    <button id="export-website-btn" class="btn"><i class="fas fa-file-export"></i> <span data-i18n="project.export">Exporter site web</span></button>
                    <button id="publish-forge-btn" class="btn"><i class="fas fa-cloud-upload-alt"></i> <span data-i18n="project.publishForge">Publier sur la forge</span></button>
                    <button id="help-btn" class="btn"><i class="fas fa-question-circle"></i> <span data-i18n="project.help">Aide</span></button>
                    <input type="file" id="load-project-input" accept=".json" style="display: none;">
                </div>
                
                <!-- Contrôles de musique de fond -->
                <div class="form-group">
                    <label data-i18n="project.backgroundMusic">Musique de fond</label>
                    <div class="background-music-control">
                        <button id="background-music-play-btn" class="audio-play-btn" title="Lecture/Pause">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="background-music-info">
                            <div id="background-music-title" class="background-music-title">Aucune musique</div>
                            <div id="background-music-status" class="background-music-status">Cliquez sur "Ajouter" pour sélectionner une musique</div>
                        </div>
                        <button id="background-music-add-btn" class="btn-icon" title="Ajouter une musique">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <input type="file" id="background-music-input" accept="audio/*" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- Contenu principal -->
        <div class="main-content">
            <!-- Viewer Marzipano -->
            <div id="pano-container"></div>
            
            <!-- Barre d'outils flottante -->
            <div class="toolbar">
                <button id="toggle-sidebar-btn" class="btn-icon"><i class="fas fa-bars"></i></button>
                <div class="view-info">
                    <span id="view-info-text">Yaw: 0.00, Pitch: 0.00, FOV: 1.50</span>
                </div>
                <div class="toolbar-actions">
                    <button id="language-btn" class="btn-icon language-btn"><i class="fas fa-globe"></i></button>
                    <div class="language-dropdown">
                        <button class="language-option" data-lang="fr">Français</button>
                        <button class="language-option" data-lang="en">English</button>
                        <button class="language-option" data-lang="it">Italiano</button>
                    </div>
                    <button id="fullscreen-btn" class="btn-icon"><i class="fas fa-expand"></i></button>
                </div>
            </div>
            
            <!-- Message d'accueil (affiché quand aucune scène n'est chargée) -->
            <div id="welcome-message">
            <div class="welcome-content">
                <h2 data-i18n="welcome.title">Bienvenue dans Spynorama</h2>
                <p data-i18n="welcome.message">Commencez par ajouter une scène en important une image panoramique.</p>
                <button id="welcome-add-scene-btn" class="btn primary"><i class="fas fa-plus"></i> <span data-i18n="scenes.add">Ajouter une scène</span></button>
                <button id="welcome-add-scene-url-btn" class="btn"><i class="fas fa-link"></i> <span data-i18n="scenes.addUrl">Ajouter via URL</span></button>
                <p data-i18n="welcome.dragDrop">Ou glissez-déposez une image panoramique ici</p>
                <p class="small" data-i18n="welcome.formats">Formats supportés: JPG, JPEG, PNG</p>
            </div>
            </div>
            
            <!-- Zone de drop pour le drag & drop -->
            <div id="drop-zone" class="hidden">
                <div class="drop-message">
                    <i class="fas fa-upload"></i>
                    <p data-i18n="welcome.dropMessage">Déposez votre image panoramique ici</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Modal pour l'édition des hotspots -->
    <div id="hotspot-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="hotspot-modal-title" data-i18n="hotspots.modalTitle">Éditer le hotspot</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="hotspot-title" data-i18n="hotspots.title">Titre</label>
                    <input type="text" id="hotspot-title" data-i18n-placeholder="hotspots.title" placeholder="Titre du hotspot">
                </div>
                
                <!-- Champs spécifiques au type de hotspot -->
                <div id="info-hotspot-fields">
                    <div class="form-group">
                        <label for="hotspot-content">Contenu</label>
                        <textarea id="hotspot-content" placeholder="Contenu informatif"></textarea>
                    </div>
                </div>
                
                <div id="link-hotspot-fields">
                    <div class="form-group">
                        <label for="hotspot-url">URL</label>
                        <input type="url" id="hotspot-url" placeholder="https://exemple.com">
                    </div>
                    <div class="form-group">
                        <label for="hotspot-target">Ouvrir dans</label>
                        <select id="hotspot-target">
                            <option value="_blank">Nouvel onglet</option>
                            <option value="_self">Même onglet</option>
                        </select>
                    </div>
                </div>
                
                <div id="scene-hotspot-fields">
                    <div class="form-group">
                        <label for="hotspot-scene-target">Scène de destination</label>
                        <select id="hotspot-scene-target">
                            <!-- Options ajoutées dynamiquement -->
                        </select>
                    </div>
                </div>
                
                <div id="photo-hotspot-fields">
                    <div class="form-group">
                        <label for="hotspot-photo-url">URL de l'image</label>
                        <input type="url" id="hotspot-photo-url" placeholder="https://exemple.com/image.jpg">
                    </div>
                    <div class="form-group">
                        <label for="hotspot-photo-description">Description</label>
                        <textarea id="hotspot-photo-description" placeholder="Description de l'image"></textarea>
                    </div>
                </div>
                
                <div id="video-hotspot-fields">
                    <div class="form-group">
                        <label for="hotspot-video-url">URL de la vidéo</label>
                        <input type="url" id="hotspot-video-url" placeholder="https://www.youtube.com/watch?v=...">
                    </div>
                    <div class="form-group">
                        <label for="hotspot-video-type">Type de vidéo</label>
                        <select id="hotspot-video-type">
                            <option value="youtube">YouTube</option>
                            <option value="vimeo">Vimeo</option>
                            <option value="podeduc">Podeduc</option>
                            <option value="direct">Lien direct</option>
                        </select>
                    </div>
                    <div id="podeduc-iframe-field" class="form-group" style="display: none;">
                        <label for="hotspot-podeduc-iframe">Code iframe Podeduc</label>
                        <textarea id="hotspot-podeduc-iframe" placeholder="<iframe src=&quot;https://podeduc.apps.education.fr/video/...&quot; ...></iframe>" rows="5"></textarea>
                        <p class="help-text">Collez ici le code iframe fourni par Podeduc</p>
                    </div>
                    <div class="form-group">
                        <label for="hotspot-video-description">Description</label>
                        <textarea id="hotspot-video-description" placeholder="Description de la vidéo"></textarea>
                    </div>
                </div>
                
                <div id="audio-hotspot-fields">
                    <div class="form-group">
                        <label for="hotspot-audio-url">URL du fichier audio</label>
                        <input type="url" id="hotspot-audio-url" placeholder="https://exemple.com/audio.mp3">
                    </div>
                    <div class="form-group">
                        <label for="hotspot-audio-file">Ou sélectionnez un fichier audio</label>
                        <input type="file" id="hotspot-audio-file" accept="audio/*">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hotspot-audio-autoplay">
                            Lecture automatique au chargement de la scène
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hotspot-audio-loop">
                            Lecture en boucle
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="hotspot-audio-description">Description</label>
                        <textarea id="hotspot-audio-description" placeholder="Description de l'audio"></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="hotspot-position">Position</label>
                    <div class="position-display">
                        <span>Yaw: <span id="hotspot-yaw">0.00</span></span>
                        <span>Pitch: <span id="hotspot-pitch">0.00</span></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="delete-hotspot-btn" class="btn danger"><i class="fas fa-trash"></i> Supprimer</button>
                <button id="save-hotspot-btn" class="btn primary"><i class="fas fa-save"></i> Enregistrer</button>
            </div>
        </div>
    </div>
    
    <!-- Modal pour ajouter une scène via URL -->
    <div id="add-url-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter une scène via URL</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="scene-url">URL de l'image panoramique</label>
                    <input type="url" id="scene-url" placeholder="https://exemple.com/image.jpg">
                </div>
                <div class="form-group">
                    <label for="scene-url-name">Nom de la scène</label>
                    <input type="text" id="scene-url-name" placeholder="Nom de la scène">
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-url-btn" class="btn">Annuler</button>
                <button id="add-url-btn" class="btn primary"><i class="fas fa-plus"></i> Ajouter</button>
            </div>
        </div>
    </div>
    
    <!-- Modal pour configurer la musique de fond -->
    <div id="background-music-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurer la musique de fond</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="background-music-url">URL du fichier audio</label>
                    <input type="url" id="background-music-url" placeholder="https://exemple.com/audio.mp3">
                </div>
                <div class="form-group">
                    <label for="background-music-file">Ou sélectionnez un fichier audio</label>
                    <input type="file" id="background-music-file" accept="audio/*">
                </div>
                <div class="form-group">
                    <label for="background-music-volume">Volume</label>
                    <input type="range" id="background-music-volume" min="0" max="1" step="0.1" value="0.5">
                    <div class="volume-display">
                        <span id="background-music-volume-value">50%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="background-music-autoplay" checked>
                        Lecture automatique au chargement du projet
                    </label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="background-music-loop" checked>
                        Lecture en boucle
                    </label>
                </div>
                <div id="background-music-preview" class="audio-preview">
                    <!-- Le contrôle audio sera ajouté ici dynamiquement -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-background-music-btn" class="btn">Annuler</button>
                <button id="save-background-music-btn" class="btn primary"><i class="fas fa-save"></i> Enregistrer</button>
            </div>
        </div>
    </div>
    
    <!-- Modal pour les options d'export -->
    <div id="export-options-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Options d'export du site web</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="export-title">Titre du site</label>
                    <input type="text" id="export-title" placeholder="Titre de votre visite virtuelle" value="Visite virtuelle 360°">
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="export-scenebar" checked>
                        Afficher la barre de scènes
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="export-show-title" checked>
                        Afficher le titre (en haut de la page)
                    </label>
                </div>
                
                <div class="form-group" id="export-url-images-group">
                    <label for="export-url-images">Images via URL</label>
                    <select id="export-url-images" class="form-control">
                        <option value="keep">Conserver les URLs externes</option>
                    </select>
                    <p class="help-text">Choisissez comment traiter les images ajoutées via URL.</p>
                </div>
                
                <div class="form-group">
                    <label for="export-image-quality">Qualité des images</label>
                    <select id="export-image-quality" class="form-control">
                        <option value="native">Native - Qualité originale</option>
                        <option value="optimized" selected>Optimisée - 1 Mo max par image</option>
                        <option value="reduced">Réduite - 256 Ko max par image</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-export-btn" class="btn">Annuler</button>
                <button id="confirm-export-btn" class="btn primary"><i class="fas fa-file-export"></i> Exporter</button>
            </div>
        </div>
    </div>
    
    <!-- Modal pour la publication sur la forge -->
    <div id="publish-forge-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Publication sur la forge</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="forge-token">Token d'accès à la forge</label>
                    <input type="password" id="forge-token" placeholder="Votre token d'accès personnel">
                    <p class="help-text">Vous pouvez obtenir un token dans les paramètres de votre compte sur la forge.</p>
                </div>
                
                <div class="form-group">
                    <label for="forge-name">Nom du spynorama</label>
                    <input type="text" id="forge-name" placeholder="Nom du dépôt à créer">
                </div>
                
                <div class="form-group">
                    <label for="etabli-url">URL de l'établi</label>
                    <input type="text" id="etabli-url" value="https://etabligit-1.onrender.com" placeholder="URL de l'application l'établi">
                </div>
                
                <div id="publish-status" style="display: none; margin-top: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 4px;"></div>
                
                <div id="published-url-container" style="display: none; margin-top: 15px;">
                    <label for="published-url">URL du site publié</label>
                    <div class="input-group">
                        <input type="text" id="published-url" readonly>
                        <button id="copy-url-btn" class="btn" onclick="navigator.clipboard.writeText(document.getElementById('published-url').value).then(() => alert('URL copiée !'))">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-publish-btn" class="btn">Annuler</button>
                <button id="confirm-publish-btn" class="btn primary"><i class="fas fa-cloud-upload-alt"></i> Publier</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
